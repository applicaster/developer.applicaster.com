This repo started as a sandbox experiment for the Zapp-pipes datasource plugin system.
It now contains a dependency to the core library, as well as all the available providers. It also includes a node.js server to test requests for each provider. This server is deployed to heroku automatically when changes are merged to master. 

The providers and the main library will work exactly the same way as it would in the app. The only change is that since it is served as a http server, request urls are a bit different.
Instead of calling `{provider-name}://fetchData?type=${request_type}&otherParams=...` you need to call `http://zapp-pipes.herokuapp.com/{provider-name}/fetchData?type=${request_type}&otherParams=...`

Also note that for each provider, you can call `http://zapp-pipes.herokuapp.com/{provider-name}/help` to see the content of the help section inside the provider's manifest.

It also deploys a test bundle to s3. This bundle should not be used for production as it includes all registered providers, and has a size which could significantly increase the loading time. The bundle can be found at the following url : `https://assets-secure.applicaster.com/zapp/zapp-pipes/index.bundle.js`

This project requires node >= 7.4 and the yarn package manager
You will also need to have a npm token set in your environment variables. If you don't have it, ask for it in #product-zapp-pipes

## Adding a new provider : 
Before doing this, make sure the provider is created according to the documentation, and published as a scoped npm package under applicaster's npm account.
* clone this repo locally, and install dependencies by running `yarn`
* add the provider dependency as an npm package by running `yarn add @applicaster/zapp-pipes-provider-{provider-name}`
* add `{provider-name}` of the provider in `src/config/providers.json`
* submit a PR with the new provider. Once it's approved, if tests pass and deploy to heroku succeeds, you will be able to test the provider in http://zapp-pipes.herokuapp.com

## Updating a provider
first make sure that the latest changes to the provider have been pubished on npm
* clone this project locally, make sure you pulled the latest code, and install dependencies by running `yarn`
* update the provider package by running the command `yarn add @applicaster/zapp-pipes-provider-{provider-name}@latest`
* commit the changes in `package.json` and `yarn.lock` to a new branch, and submit a PR for it
* once the PR is merged to master, the provider will be updated both on heroku and in the s3 test bundle. 

## Using npm commands
The project contains npm scripts to perform several actions. run `npm run` to see a list of available commands

the main commands are the following ones : 
- `npm run start:dev` : will kick out a node.js server on port 3000 (unless changed in the config files) where providers can be tested. This is basically a dev version of the server deployed on heroku.
- `npm run start:script`: will kick out a node.js server on port 8080, which exposes the output bundle. This can be used to test the bundle locally inside the app, by using the `local` mode instead of `production` in the JSPipes manager native classes
- `npm run make`: this command will generate a new index.bundle.js file in the `bundle` folder
- `npm run deploy`: this command will summon `npm run make` and then deploy the bundle in `https://assets-secure.applicaster.com/zapp/react-native-bundles/zapp_pipes/index.bundle.js`. This command requires the `aws` cli tool to be installed and configured with valid credentials to upload content on s3.

See here to install the aws cli : http://docs.aws.amazon.com/cli/latest/userguide/installing.html
Then run `aws configure` and provide the key and secret. Region must be set to `us-east-1`
